<launch>
    <!-- VLA Vision Scheduler Launch File -->
    <!-- 视觉调度核心启动文件 -->
    
    <!-- 参数设置 -->
    <arg name="enable_vlm" default="true" />
    <arg name="enable_yolo" default="true" />
    <arg name="enable_depth" default="true" />
    <arg name="default_camera" default="camera_1" />
    <arg name="default_depth_camera" default="depth_cam_1" />
    <arg name="confidence_threshold" default="0.5" />
    
    <!-- 启动视觉服务器 -->
    <include file="$(find ros_vla_vision)/launch/vla_vision_server.launch">
        <arg name="detection_model" value="yolov8" />
        <arg name="pose_model" value="dope" />
        <arg name="feature_model" value="sift" />
        <arg name="vlm_type" value="clip" />
        <arg name="enable_gpu" value="true" />
        <arg name="confidence_threshold" value="$(arg confidence_threshold)" />
    </include>
    
    <!-- 启动视觉调度器 -->
    <node name="vla_vision_scheduler" 
          pkg="ros_vla_vision" 
          type="vla_vision_scheduler.py" 
          output="screen">
        
        <!-- 参数传递 -->
        <param name="enable_vlm" value="$(arg enable_vlm)" />
        <param name="enable_yolo" value="$(arg enable_yolo)" />
        <param name="enable_depth" value="$(arg enable_depth)" />
        <param name="default_camera" value="$(arg default_camera)" />
        <param name="default_depth_camera" value="$(arg default_depth_camera)" />
        <param name="confidence_threshold" value="$(arg confidence_threshold)" />
        
    </node>
    
    <!-- 启动相机模拟器（如果没有真实相机） -->
    <group if="$(eval arg('default_camera') == 'camera_1')">
        <node name="camera_simulator" 
              pkg="ros_vla_vision" 
              type="camera_simulator.py" 
              output="screen"
              if="$(optenv USE_CAMERA_SIMULATOR false)">
            <param name="image_topic" value="/camera_1/image_raw" />
            <param name="camera_info_topic" value="/camera_1/camera_info" />
            <param name="publish_rate" value="10" />
        </node>
    </group>
    
    <!-- 启动深度相机模拟器（如果没有真实深度相机） -->
    <group if="$(eval arg('default_depth_camera') == 'depth_cam_1')">
        <node name="depth_camera_simulator" 
              pkg="ros_vla_vision" 
              type="depth_camera_simulator.py" 
              output="screen"
              if="$(optenv USE_DEPTH_SIMULATOR false)">
            <param name="point_cloud_topic" value="/depth_cam_1/points" />
            <param name="publish_rate" value="10" />
        </node>
    </group>
    
</launch>
